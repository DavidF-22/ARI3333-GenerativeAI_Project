const redThemeButton=document.querySelector(".red-theme"),blueThemeButton=document.querySelector(".blue-theme"),darkThemeButton=document.querySelector(".dark-theme--to_light"),navElement=document.querySelector(".nav"),hamburgerElement=document.querySelector(".hamburger"),bodyElement=document.querySelector("body"),chatHistoryHeader=document.querySelector(".chatHistory h1"),chatInButton=document.querySelector(".chatIn .chatInputButton"),chatClickToConvert=document.querySelector(".chatIn #click_to_convert"),chatHistoryElement=document.querySelector(".chatHistory"),textareaElement=document.querySelector(".chatIn textarea"),headerElement=document.querySelector(".header"),largeIconElement=document.querySelector(".initialIcon img"),faviconElement=document.querySelector('link[rel="icon"]'),footerIcon=document.querySelector(".footer-img"),footerBackground=document.querySelector(".footer"),toggleAllButton=document.querySelector(".toggle-all-btn"),backToTop=document.querySelector(".backToTop"),newChatButton=document.querySelector(".new-chat"),userMessageContainer=document.getElementById("userMessageContainer"),jsonPrevArrow=document.querySelector("#json-prev img"),jsonNextArrow=document.querySelector("#json-next img"),jsonNavButtons=document.querySelectorAll(".json-nav-buttons");let jsonFileName="";function sleep(e){return new Promise(t=>setTimeout(t,e))}function promptForFileName(e){let t=prompt(e,"Ex: Chatbot_Conversation");jsonFileName=t.trim(),userOut&&aiImgOut&&(userOut.textContent="",aiImgOut.innerHTML="",userMessageContainer.style.display="none",aiMessageContainer.style.display="none",initialContent.style.display="block")}function getCurrentDate(){let e=new Date,t=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return`${t}-${o}-${n}`}function toggleTextColor(e){let t=document.querySelectorAll("h1, h2, h3, ol, ul, span, p, a, .logo, button, .json-date, .file-link"),o=document.querySelectorAll("pre");t.forEach(t=>{t.style.color=e?"black":"white"}),o.forEach(t=>{t.style.backgroundColor=e?"#6a6a6a":"#333"}),textareaElement&&textareaElement.style.setProperty("--placeholder-color",e?"black":"white"),userMessageContainer&&(userMessageContainer.style.color=e?"black":"white")}function blobToBase64(e){return new Promise((t,o)=>{let n=new FileReader;n.onloadend=()=>t(n.result),n.onerror=o,n.readAsDataURL(e)})}newChatButton&&newChatButton.addEventListener("click",()=>{window.location.pathname.endsWith("index.php")&&promptForFileName("Enter a name for the JSON file: ")});const themes={red:{icon:"assets/images/RenderersRealm_Icon3.png",favicon:"assets/images/RenderersRealm_Icon3.png",headerColor:"#790808",chatHistoryColor:"#790808",textareaColor:"#790808",borderColor:"#790808",footerIcon:"assets/images/UoM_AI_Logo_black.png",footerBackground:"#790808",bodyColor:"#2c2c2c",jsonFileIcon:"assets/images/document.png",newChatButton:{background:"#ce8600",hover:"#e79600"},chatClickToConvert:{background:"orange",hover:"#c58000"},chatInButton:{background:"orange",hover:"#c58000"},toggleAllButton:{background:"#ce8600",hover:"#e79600"},backToTop:{background:"#ce8600",hover:"#e79600"},textLight:!1},blue:{icon:"assets/images/RenderersRealm_Icon2.png",favicon:"assets/images/RenderersRealm_Icon2.png",headerColor:"#48a6ccb3",chatHistoryColor:"#48a6ccb3",textareaColor:"#48a6ccb3",borderColor:"#48a6ccb3",footerIcon:"assets/images/UoM_AI_Logo.png",footerBackground:"#48a6ccb3",bodyColor:"#2c2c2c",jsonFileIcon:"assets/images/document.png",newChatButton:{background:"#564bfe",hover:"#4537bd"},chatClickToConvert:{background:"#564bfe",hover:"#4537bd"},chatInButton:{background:"#564bfe",hover:"#4537bd"},toggleAllButton:{background:"#564bfe",hover:"#4537bd"},backToTop:{background:"#564bfe",hover:"#4537bd"},textLight:!1},dark:{icon:"assets/images/RenderersRealm_Icon1.png",favicon:"assets/images/RenderersRealm_Icon1.png",headerColor:"#a2a2a2b3",chatHistoryColor:"#a2a2a2b3",textareaColor:"#a2a2a2b3",borderColor:"#a2a2a2b3",footerIcon:"assets/images/UoM_AI_Logo.png",footerBackground:"#a2a2a2b3",bodyColor:"#2c2c2c",jsonFileIcon:"assets/images/document.png",newChatButton:{background:"#b1b1b1b3",hover:"#aaaaaab3"},chatClickToConvert:{background:"limegreen",hover:"green"},chatInButton:{background:"limegreen",hover:"green"},toggleAllButton:{background:"#a2a2a2b3",hover:"#7b7b7bb3"},backToTop:{background:"#a2a2a2",hover:"#7b7b7b"},textLight:!1},light:{icon:"assets/images/RenderersRealm_Icon1.png",favicon:"assets/images/RenderersRealm_Icon1.png",headerColor:"#a2a2a2b3",chatHistoryColor:"#a2a2a2b3",textareaColor:"#a2a2a2b3",borderColor:"#a2a2a2b3",footerIcon:"assets/images/UoM_AI_Logo.png",footerBackground:"#a2a2a2b3",bodyColor:"#ffffff",jsonFileIcon:"assets/images/document_white.png",newChatButton:{background:"#b1b1b1b3",hover:"#aaaaaab3"},chatClickToConvert:{background:"limegreen",hover:"green"},chatInButton:{background:"limegreen",hover:"green"},toggleAllButton:{background:"#a2a2a2b3",hover:"#7b7b7bb3"},backToTop:{background:"#a2a2a2",hover:"#7b7b7b"},textLight:!0}};function applyTheme(e){let t=themes[e];if(!t)return;if(largeIconElement&&(largeIconElement.src=t.icon),faviconElement&&(faviconElement.href=t.favicon),headerElement&&(headerElement.style.backgroundColor=t.headerColor),chatHistoryElement&&(chatHistoryElement.style.backgroundColor=t.chatHistoryColor),textareaElement&&(textareaElement.style.backgroundColor=t.textareaColor),chatHistoryHeader&&(chatHistoryHeader.style.borderBottomColor=t.borderColor),footerIcon&&(footerIcon.src=t.footerIcon),footerBackground&&(footerBackground.style.backgroundColor=t.footerBackground),bodyElement&&(bodyElement.style.backgroundColor=t.bodyColor),jsonPrevArrow&&jsonNextArrow){let o="assets/images/up-arrow-black.png",n="assets/images/up-arrow-white.png";"light"===e?(jsonPrevArrow.src=o,jsonNextArrow.src=o):(jsonPrevArrow.src=n,jsonNextArrow.src=n)}backToTop&&(backToTop.style.backgroundColor=t.backToTop.background,backToTop.addEventListener("mouseover",()=>{backToTop.style.backgroundColor=t.backToTop.hover}),backToTop.addEventListener("mouseout",()=>{backToTop.style.backgroundColor=t.backToTop.background}));let a=[{button:newChatButton,config:t.newChatButton},{button:chatClickToConvert,config:t.chatClickToConvert},{button:chatInButton,config:t.chatInButton},{button:toggleAllButton,config:t.toggleAllButton},];a.forEach(({button:e,config:t})=>{e&&(e.style.backgroundColor=t.background,e.addEventListener("mouseover",()=>{e.style.backgroundColor=t.hover}),e.addEventListener("mouseout",()=>{e.style.backgroundColor=t.background}))}),jsonFileIcon=t.jsonFileIcon,fetchAndDisplayFiles(),toggleTextColor(t.textLight)}function saveThemeToLocalStorage(e){localStorage.setItem("selectedTheme",e)}function initializeTheme(){let e=localStorage.getItem("selectedTheme");applyTheme(e),console.log("Current Theme: "+e)}async function saveToJSON(e,t){if(!jsonFileName){console.error("No active JSON file. Please select or create a file.");return}let o=getCurrentDate(),n=`${jsonFileName}.json`;try{let a=await fetch(`assets/json/${o}/${n}`),r=[];a.ok?r=await a.json():console.log("No existing data found. Creating a new file.");let l={userInput:e,aiImageUrl:t,timestamp:new Date().toISOString()};r.push(l);let s=await fetch("save_to_json.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({date:o,fileName:n,data:r})});if(!s.ok)throw Error("Failed to save data to JSON.");let i=await s.json();console.log("Data saved successfully:",i)}catch(c){console.error("Error appending data to JSON file:",c)}}async function fetchAndDisplayFiles(){try{let e=await fetch("get_json_files.php");if(!e.ok)throw Error("Failed to fetch JSON files.");let t=await e.json(),o=document.getElementById("creationDate"),n=document.getElementById("jsonFileList");if(o.innerHTML="",n.innerHTML="",0===Object.keys(t).length)console.log("No JSON files or dates found.");else{let a=Object.keys(t).sort((e,t)=>new Date(t)-new Date(e));a.forEach(e=>{let o=document.createElement("li");o.classList.add("json-date"),o.textContent=`Date: ${e}`,n.appendChild(o),t[e].forEach(t=>{let o=`assets/json/${e}/${t}`,a=t.replace(/\.json$/,""),r=document.createElement("li");r.classList.add("json-file"),r.innerHTML=`
                        <img src="${jsonFileIcon}" alt="icon_file">
                        <button data_img_path="${o}" target="_blank" class="file-link">${a}</button>
                    `,n.appendChild(r)})});let r="light"===localStorage.getItem("selectedTheme");toggleTextColor(r)}}catch(l){console.error("Error fetching JSON files:",l)}}document.addEventListener("DOMContentLoaded",initializeTheme()),redThemeButton&&redThemeButton.addEventListener("click",()=>{saveThemeToLocalStorage("red"),applyTheme("red")}),blueThemeButton&&blueThemeButton.addEventListener("click",()=>{saveThemeToLocalStorage("blue"),applyTheme("blue")}),darkThemeButton&&darkThemeButton.addEventListener("click",()=>{let e="dark"===localStorage.getItem("selectedTheme");e?(saveThemeToLocalStorage("light"),applyTheme("light")):(saveThemeToLocalStorage("dark"),applyTheme("dark"))}),hamburgerElement&&navElement&&(hamburgerElement.addEventListener("click",()=>{navElement.classList.toggle("nav--open"),hamburgerElement.classList.toggle("hamburger--open")}),navElement.addEventListener("click",()=>{navElement.classList.remove("nav--open"),hamburgerElement.classList.remove("hamburger--open")})),chatHistoryElement&&document.addEventListener("DOMContentLoaded",()=>{fetchAndDisplayFiles()}),chatClickToConvert&&chatClickToConvert.addEventListener("click",function(){window.SpeachRecognition=window.webkitSpeechRecognition;let e=new SpeachRecognition;e.interimResults=!0,e.addEventListener("result",e=>{let t=Array.from(e.results).map(e=>e[0]).map(e=>e.transcript).join("");textareaElement.innerHTML=t}),e.addEventListener("start",()=>{chatClickToConvert.classList.add("listening")}),e.addEventListener("end",()=>{chatClickToConvert.classList.remove("listening")}),e.start()});const aiMessageContainer=document.getElementById("aiMessageContainer"),aiImgOut=document.getElementById("aiMessage"),userOut=document.getElementById("userMessage"),initialContent=document.getElementById("initialContent");if(chatInButton&&textareaElement&&userOut&&initialContent){async function e(e){initialContent.style.display="none",userMessageContainer.style.display="block",userOut.innerHTML=e,aiMessageContainer.style.display="block",aiImgOut.innerHTML='<img src="assets/images/loading.gif" alt="Loading..." />',jsonNavButtons.forEach(e=>{e.style.display="block"});let t=await fetch("https://api-inference.huggingface.co/models/black-forest-labs/FLUX.1-dev",{headers:{Authorization:"Bearer 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"},method:"POST",body:JSON.stringify({inputs:e})});if(!t.ok)throw Error("API request failed");let o=await t.blob();return o}async function t(){let t=textareaElement.value.trim();""!==t&&(textareaElement.value="",e(t).then(async e=>{if(e){let o=await blobToBase64(e);aiImgOut.innerHTML=`<img src="${o}" alt="AI Output" />`,saveToJSON(t,o).then(()=>{fetchAndDisplayFiles()})}}))}chatInButton.addEventListener("click",t),textareaElement.addEventListener("keydown",e=>{if("Enter"===e.key&&e.shiftKey){if(e.preventDefault(),!jsonFileName){alert("File name is not set yet"),sleep(ms=250).then(()=>{promptForFileName("Enter a name for the JSON file: ")});return}t()}})}window.location.pathname.endsWith("index.php")&&document.addEventListener("click",async e=>{let t=e.target.closest(".file-link");if(t){let o=t.getAttribute("data_img_path");if(console.log("Fetching JSON file from:",o),!o){console.error("File path not found in data attribute.");return}try{fetchAndDisplayFiles();let n=o.split("/").pop().replace(".json","");jsonFileName=n,console.log("Active JSON file name set to:",jsonFileName);let a=await fetch(o);if(!a.ok)throw Error("Failed to fetch the JSON file.");let r=await a.json(),l=r.reverse();initialContent&&(initialContent.style.display="none"),userMessageContainer&&(userMessageContainer.style.display="block"),aiMessageContainer&&(aiMessageContainer.style.display="block"),jsonNavButtons&&jsonNavButtons.forEach(e=>{e.style.display="block"});let s=l[0];userOut.textContent=s.userInput||"No user input found.",aiImgOut.innerHTML=s.aiImageUrl?`<img src="${s.aiImageUrl}" alt="AI Output" />`:"No AI output image found."}catch(i){console.error("Error fetching or processing JSON file:",i)}}});let currentJsonData=[],currentIndex=0;function displayJsonEntry(e){if(!currentJsonData||0===currentJsonData.length){console.error("No JSON data loaded.");return}if(e<0||e>=currentJsonData.length){console.error("Index out of bounds.");return}currentIndex=e;let t=currentJsonData[e];userOut&&(userOut.textContent=t.userInput||"No user input found."),aiImgOut&&(aiImgOut.innerHTML=t.aiImageUrl?`<img src="${t.aiImageUrl}" alt="AI Output" />`:"No AI output image found.")}const jsonPrevButton=document.querySelector("#json-prev"),jsonNextButton=document.querySelector("#json-next");async function loadJsonFile(e){try{let t=await fetch(e);if(!t.ok)throw Error("Failed to fetch JSON file.");let o=await t.json();(currentJsonData=o.reverse()).length>0?displayJsonEntry(0):console.log("No entries found in the JSON file.")}catch(n){console.error("Error loading JSON file:",n)}}jsonPrevButton&&jsonPrevButton.addEventListener("click",()=>{if(currentJsonData.length>0){let e=currentIndex-1;e>=0?displayJsonEntry(e):alert("Already at the most recent entry.")}}),jsonNextButton&&jsonNextButton.addEventListener("click",()=>{if(currentJsonData.length>0){let e=currentIndex+1;e<currentJsonData.length?displayJsonEntry(e):alert("Already at the last entry.")}}),document.addEventListener("click",async e=>{let t=e.target.closest(".file-link");if(t){let o=t.getAttribute("data_img_path");console.log("Loading JSON file:",o),await loadJsonFile(o)}}),toggleAllButton&&document.addEventListener("DOMContentLoaded",()=>{let e=document.querySelectorAll(".faq-question"),t=document.getElementById("toggle-all");e.forEach(e=>{e.addEventListener("click",()=>{let t=e.nextElementSibling;e.classList.toggle("open"),t.style.display="block"===t.style.display?"none":"block"})}),t.addEventListener("click",()=>{let o=[...e].every(e=>e.classList.contains("open"));e.forEach(e=>{let t=e.nextElementSibling;o?(e.classList.remove("open"),t.style.display="none"):(e.classList.add("open"),t.style.display="block")}),t.textContent=o?"Expand All":"Collapse All"})}),document.addEventListener("DOMContentLoaded",()=>{let e=document.querySelector(".backToTop");if(e){let t=()=>{window.scrollY>50?e.classList.add("active"):e.classList.remove("active")};e.addEventListener("click",e=>{e.preventDefault(),window.scrollTo({top:0,behavior:"smooth"})}),window.addEventListener("scroll",t)}}),window.addEventListener("load",function(){let e=document.querySelector(".preloader");setTimeout(function(){e.classList.add("preloader--hiden")})});